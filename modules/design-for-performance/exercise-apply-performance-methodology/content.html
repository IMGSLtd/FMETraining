<p>C:\FMEData2019\Workspaces\DesktopBasic\BestPractice-Ex2-Complete.fmw</p>
<h2 id="learning-objectives">
  <span>Learning Objectives</span>
</h2>
<p>After completing this unit, you’ll be able to:</p>
<ul>
  <li>Remove unnecessary attributes to improve performance.</li>
  <li>Track down unnecessary lists and remove them.</li>
  <li>Improve performance by collapsing bookmarks to prevent excess caching.</li>
  <li>Use workspace templates including caches to measure performance improvements.</li>
</ul>
<h2 id="resources">
  <span>Resources</span>
</h2>
<ul>
  <li>Starting workspace</li>
</ul>
<h2 id="exercise">
  <span>Exercise</span>
</h2>
<p>You have been assigned to a project to calculate the "walkability" of each address in the city of Vancouver. Walkability is a measure of how easy it is to access local facilities on foot. The starting workspace calculates a walkability score based on a number of criteria.</p>
<p>In this exercise, we will modify our workspace to improve its performance.</p>
<h2 id="1-start-workbench">
  <span>1) Start Workbench</span>
</h2>
<p>Start FME Workbench 2021.0 and open the <a href="https://s3.amazonaws.com/FMEData/FMEData2021/Workspaces/UseDataIntegrationBestPractices/exercise-improving-workspace-style.fmw" rel="noreferrer noopener" target="_blank">starting workspace</a>. Run it to create feature caches while you complete step #2.</p>
<h2 id="2-examine-workspace">
  <span>2) Examine Workspace</span>
</h2>
<p>The workspace is pretty unorganized. Let’s examine it in sections to figure out how it works.</p>
<p><img src="https://trailhead-cs-production-private-images.s3.amazonaws.com/00D30000000ePES/safe/modules/document-your-workspace/exercise-improving-workspace-style/images/cd1f25e7c803579f74d65fda41b763eb_68881-cd-1-1-d-93-40-e-2-b-8-c-5-21-cc-74-f-2-e-9-e-0.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAQCWQ2ZQ4PMOG4SPY%2F20210416%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20210416T223724Z&amp;X-Amz-Expires=43260&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=aa7dd72bf34eb149b20147086ae53a30634d16321995bab0a1baf199ec894948" width="624" height="248" alt="Workspace sections" class="image image-block image-center" /></p>
<ol>
  <li>PostalAddress and PostcodeBoundaries read from Addresses.gdb.</li>
  <li>Transformers clean up attributes from the PostalAddress feature type to create a separate Number and Street attribute. Then the last two digits of the Number are being replaced by XX to create an attribute that will be the Join Key for joining the crime data.</li>
  <li>Crime reads from Crime.csv. This dataset stores the street number for each crime incident with XX as the last two digits to protect anonymity.</li>
  <li>The FeatureJoiner joins PostalAddress and the Crime data based on the Join Key attribute from section two and the Block attribute from Crime.</li>
  <li>These transformers give the crime Type attribute a number based on severity and then calculate the total CrimeValue for each address block. Then the CenterPointReplacer extracts only one point if there are multiple crime incidents in the same location.</li>
  <li>The workspace reads the Parks MapInfo TAB file. It will use this data to measure the walking distance from addresses to parks.</li>
  <li>The NeighborFinder determines the park closest to each address.</li>
  <li>The AttributeRenamer renames the _distance attribute from the NeighborFinder to ParkDistance.</li>
  <li>The Creator and the FeatureReader read a Planning Restrictions OGC Geopackage, including noise restriction areas from the NoiseControlAreas layer.</li>
  <li>The PointOnAreaOverlayer joins the point data containing the crime, distance to park, and addresses with the NoiseControlAreas polygons. This joined data assigns the noise restrictions to any overlapping points. The AttributeValueMapper is used to assign the zone with a score, creating the attribute NoiseZoneScore. This new attribute will reflect that addresses in noise-restricted areas are more walkable.</li>
</ol>
<div class="box message info">
  <div class="inner">
    <div class="bd">
      <div class="media">
        <img class="img mtm" src="https://res.cloudinary.com/hy4kyit2a/image/upload/doc/trailhead/en-usb473bb5ea1b7e61dfb07e6a7e547de6b.gif" alt="Note" />
        <div class="mediaBd">
          <div class="message-media-content">
            <p>You can optionally use Tools &gt; Apply Auto-Layout or follow the instructions in <a href="https://safe.my.trailhead.com/content/safe/modules/document-your-workspace/exercise-improving-workspace-style" rel="noreferrer noopener" target="_blank">Exercise: Improving Workspace Style</a> to clean up the workspace if you want.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<h2 id="3-determine-performance-improvements">
  <span>3) Determine Performance Improvements</span>
</h2>
<p>While editing the ExpressionEvaluator in the previous exercise, you might have noticed there was a lot of additional attributes like CrimeList{}.City or CrimeList{}.Block. These excess attributes clutter the display and inspecting the output becomes hard. These attributes can hardly be helping the performance of the workspace either - even if that's mitigated by using caches during development.</p>
<p>Let's save the workspace as a template file. In the top menu go to File &gt; Save As Template. When prompted, be sure to have the Include Feature Caches option checked:</p>
<p><a href="https://s3.amazonaws.com/gitbook/Desktop-Basic-2019/DesktopBasic5BestPractice/Images/Img5.219.Ex3.SaveCaches.png" rel="noreferrer noopener" target="_blank"><img src="https://s3.amazonaws.com/gitbook/Desktop-Basic-2019/DesktopBasic5BestPractice/Images/Img5.219.Ex3.SaveCaches.png" alt class="image image-block image-center" /></a></p>
<p>Now if we come back to this project later or share it, the user can reopen the template and have all our cached data ready for use.</p>
<p>Check the size of the template file BestPractice-Ex2-Begin.fmwt that you just created. You'll see that it is almost 50mb in size, which is fairly large for a template. It's not a problem to have a large template file, but it does indicate a lot of data is being cached and that this could affect the workspace's performance.</p>
<p>One aspect of data is the number of attributes and lists. Since there are a lot of additional attributes to remove but only a few we need to keep, we will use the AttributeKeeper transformer. Place the AttributeKeeper between the AttributeValueMapper_2 and the ExpressionEvaluator transformers:</p>
<p><a href="https://s3.amazonaws.com/gitbook/Desktop-Basic-2019/DesktopBasic5BestPractice/Images/Img5.209.Ex2.AttributeKeeper.png" rel="noreferrer noopener" target="_blank"><img src="https://s3.amazonaws.com/gitbook/Desktop-Basic-2019/DesktopBasic5BestPractice/Images/Img5.209.Ex2.AttributeKeeper.png" alt class="image image-block image-center" /></a></p>
<p>Inspect the AttributeKeeper parameters and set them up to keep only CrimeValue, NoiseZoneScore, and PoolDistance. Take note of the names of the attributes that we are not keeping. We might be able to remove them earlier in the workspace.</p>
<h2 id="3-remove-lists">
  <span>3) Remove Lists</span>
</h2>
<p>One attribute of interest is a list attribute called CrimeList{}, which doesn't appear necessary for any part of this translation. Track down its source by pressing Ctrl+F and search for CrimeList. The search results show up in the Navigator window, and there you will find the Aggregator transformer is creating CrimeList.</p>
<p>Check the parameters for the Aggregator transformer and turn off the Generate List parameter, to prevent the list from being created. This step will cause many caches to become stale, but we will re-run the workspace shortly to solve this.</p>
<h2 id="4-remove-extra-feature-types">
  <span>4) Remove Extra Feature Types</span>
</h2>
<p>Another reason a workspace is running slowly is if you are reading in extra data that is not being used in the workspace. It looks like the original author read in the PostcodeBoundaries feature type from the Addresses.gdb. Additionally, we didn't remove the Parks feature type once we were done with it. Delete both of those now and click Yes on any warnings that pop up.</p>
<h2 id="5-collapse-the-bookmark">
  <span>5) Collapse the Bookmark</span>
</h2>
<p>Another source of excess caching are transformers producing output that we don't need to inspect. These can be prevented by hiding these transformers within a collapsed bookmark.</p>
<p>Add a bookmark around all of the transformers between the PostalAddress reader and the FeatureJoiner, by selecting all the transformers and pressing ctrl+B on your keyboard. Then name the bookmark Prepare Addresses to Join:</p>
<p><a href="https://s3.amazonaws.com/gitbook/Desktop-Basic-2019/DesktopBasic5BestPractice/Images/Img5.210.Ex2.AddABookmark.png" rel="noreferrer noopener" target="_blank"><img src="https://s3.amazonaws.com/gitbook/Desktop-Basic-2019/DesktopBasic5BestPractice/Images/Img5.210.Ex2.AddABookmark.png" alt class="image image-block image-center" /></a></p>
<p><strong><em>Note:</em></strong> <em>Bookmarks will be covered in greater detail later on in this chapter.</em></p>
<p>Now we can collapse the bookmark and then when we re-run the translation only the last transformer will have a cache. To collapse the bookmark, click on the arrow beside the bookmark name:</p>
<p><a href="https://s3.amazonaws.com/gitbook/Desktop-Basic-2019/DesktopBasic5BestPractice/Images/Img5.211.Ex2.CollapsedBookmarks.png" rel="noreferrer noopener" target="_blank"><img src="https://s3.amazonaws.com/gitbook/Desktop-Basic-2019/DesktopBasic5BestPractice/Images/Img5.211.Ex2.CollapsedBookmarks.png" alt class="image image-block image-center" /></a></p>
<hr />
<table class="featureTable sort_table">
  <tbody class="tbody">
    <tr>
      <td>FME Lizard Says...</td>
    </tr>
    <tr>
      <td>If you want to work ahead, add a couple more bookmarks around other sections and then collapse them. We will be doing this in the next exercise, so you can see if your bookmarks are the same.</td>
    </tr>
  </tbody>
</table>
<hr />
<h2 id="6-run-the-workspace">
  <span>6) Run the Workspace</span>
</h2>
<p>Now run the workspace by clicking on the ExpressionEvaluator and choosing <em>Run to This</em> or just click the run button.</p>
<p>The workspace will run and data will be cached, but for the collapsed bookmark, only one cache will be created for its five transformers. Attributes unnecessary to the output will also be removed by the AttributeKeeper.</p>
<p>Save the workspace as a new template and check the option to include caches. Check the file size of the new template. It should be considerably smaller (around 16mb).</p>
<p><strong><em>Note:</em></strong> <em>If you want to use the workspaces provided, just open them and save them as a template file to use for your comparison</em></p>